Add-Type -AssemblyName System.Windows.Forms
[System.Windows.Forms.Application]::EnableVisualStyles()

$form = New-Object System.Windows.Forms.Form
$form.Text = "Pannello Tweak ZZTWI"
$form.Size = New-Object System.Drawing.Size(400,400)
$form.StartPosition = "CenterScreen"

$checkboxes = @{}

$features = @{
    "Telemetry" = "Disattiva Telemetria"
    "Cortana" = "Disattiva Cortana"
    "OneDrive" = "Disattiva OneDrive"
    "GameDVR" = "Disattiva GameDVR"
    "Update" = "Disattiva Windows Update"
    "Defender" = "Disattiva Windows Defender"
    "Performance" = "Ottimizzazioni Performance"
}

$i = 0
foreach ($key in $features.Keys) {
    $cb = New-Object System.Windows.Forms.CheckBox
    $cb.Text = $features[$key]
    $cb.AutoSize = $true
    $cb.Location = New-Object System.Drawing.Point(30, 30 + ($i * 30))
    $form.Controls.Add($cb)
    $checkboxes[$key] = $cb
    $i++
}

$button = New-Object System.Windows.Forms.Button
$button.Text = "Applica"
$button.Location = New-Object System.Drawing.Point(150, 300)
$button.Add_Click({
    if ($checkboxes["Telemetry"].Checked) {
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" -Name "AllowTelemetry" -Value 0 -Type DWord -Force
    }
    if ($checkboxes["Cortana"].Checked) {
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\Windows Search" -Name "AllowCortana" -Value 0 -Type DWord -Force
    }
    if ($checkboxes["OneDrive"].Checked) {
        Set-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows\OneDrive" -Name "DisableFileSyncNGSC" -Value 1 -Type DWord -Force
    }
    if ($checkboxes["GameDVR"].Checked) {
        Set-ItemProperty -Path "HKCU:\System\GameConfigStore" -Name "GameDVR_Enabled" -Value 0
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\GameDVR" -Name "AllowGameDVR" -Value 0 -Type DWord -Force
    }
    if ($checkboxes["Update"].Checked) {
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" -Name "NoAutoUpdate" -Value 1 -Type DWord -Force
        Stop-Service -Name "wuauserv" -Force -ErrorAction SilentlyContinue
        Set-Service -Name "wuauserv" -StartupType Disabled
    }
    if ($checkboxes["Defender"].Checked) {
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "DisableAntiSpyware" -Value 1 -Type DWord -Force
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableRealtimeMonitoring" -Value 1 -Type DWord -Force
    }
    if ($checkboxes["Performance"].Checked) {
        Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "MenuShowDelay" -Value 10
        powercfg -h off
        bcdedit /set useplatformclock true
    }

    [System.Windows.Forms.MessageBox]::Show("âœ… Tweaks applicati!", "Completato", 'OK', 'Information')
})

$form.Controls.Add($button)
$form.Topmost = $true
$form.Add_Shown({$form.Activate()})
[void]$form.ShowDialog()
